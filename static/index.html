<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Maisha Mart Supermarket | Online Store - Kakamega, Kenya</title>
    <meta name="description" content="Maisha Mart Supermarket - Kakamega's favorite supermarket. Shop fresh vegetables, fruits, dairy, meat, bakery, beverages, household items and electronics online. Free delivery in Kakamega.">
    <meta name="keywords" content="Maisha Mart, supermarket, Kakamega, Kenya, groceries, online shopping, delivery, fresh produce, M-Pesa">
    <meta name="author" content="Maisha Mart Supermarket">

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:title" content="Maisha Mart Supermarket | Online Store">
    <meta property="og:description" content="Shop quality products at affordable prices. Kakamega's favorite supermarket - now online!">
    <meta property="og:url" content="https://www.facebook.com/maishamartsupermarket/">

    <!-- Theme Color -->
    <meta name="theme-color" content="#1B1B6F">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">

    <style>
        :root {
            --primary-blue: #1B1B6F;
            --primary-red: #E31837;
            --light-bg: #FFF8F0;
            --white: #ffffff;
            --gray-100: #f8f9fa;
            --gray-200: #e9ecef;
            --gray-500: #6c757d;
            --gray-800: #343a40;
            --success: #28a745;
            --warning: #ffc107;
            --info: #17a2b8;
            --danger: #dc3545;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Poppins', sans-serif;
            background: var(--light-bg);
            color: var(--gray-800);
            line-height: 1.6;
        }

        /* ===== HEADER ===== */
        .header {
            background: var(--white);
            padding: 1rem 5%;
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: 0 2px 20px rgba(0,0,0,0.08);
            display: flex;
            align-items: center;
            justify-content: space-between;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            cursor: pointer;
            text-decoration: none;
        }

        .logo-icon {
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, var(--primary-blue), var(--primary-red));
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            box-shadow: 0 4px 15px rgba(27,27,111,0.3);
        }

        .logo-text {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary-blue);
        }

        .logo-text span {
            color: var(--primary-red);
        }

        .logo-tagline {
            font-size: 0.7rem;
            color: var(--primary-red);
            font-style: italic;
        }

        .nav-buttons {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
        }

        .nav-btn {
            padding: 0.6rem 1.2rem;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-family: inherit;
            font-weight: 500;
            font-size: 0.9rem;
            transition: all 0.3s;
            background: var(--gray-100);
            color: var(--gray-800);
        }

        .nav-btn:hover {
            background: var(--gray-200);
            transform: translateY(-1px);
        }

        .nav-btn.active {
            background: var(--primary-blue);
            color: var(--white);
        }

        .nav-btn.cart-btn {
            position: relative;
        }

        .cart-badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background: var(--primary-red);
            color: white;
            border-radius: 50%;
            width: 22px;
            height: 22px;
            font-size: 0.75rem;
            display: flex;
            align-items: center;
            justify-content: center;
            animation: badgePop 0.3s ease;
        }

        @keyframes badgePop {
            0% { transform: scale(0); }
            50% { transform: scale(1.2); }
            100% { transform: scale(1); }
        }

        /* ===== MAIN CONTENT ===== */
        main {
            padding: 2rem 5%;
            max-width: 1400px;
            margin: 0 auto;
        }

        /* ===== HERO BANNER ===== */
        .hero-banner {
            background: linear-gradient(135deg, var(--primary-blue) 0%, #2d2d8f 50%, var(--primary-red) 100%);
            border-radius: 20px;
            padding: 3rem;
            color: white;
            text-align: center;
            margin-bottom: 2rem;
            position: relative;
            overflow: hidden;
        }

        .hero-banner::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.05) 0%, transparent 50%);
            animation: heroShimmer 10s linear infinite;
        }

        @keyframes heroShimmer {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .hero-banner h1 {
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
            position: relative;
            z-index: 1;
        }

        .hero-banner p {
            font-size: 1.1rem;
            opacity: 0.9;
            position: relative;
            z-index: 1;
        }

        .hero-features {
            display: flex;
            justify-content: center;
            gap: 2rem;
            margin-top: 1.5rem;
            flex-wrap: wrap;
            position: relative;
            z-index: 1;
        }

        .hero-feature {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.95rem;
            opacity: 0.95;
        }

        .hero-feature .icon {
            font-size: 1.3rem;
        }

        /* ===== PROMO BANNER ===== */
        .promo-bar {
            background: linear-gradient(90deg, var(--warning), #ffdb4d);
            color: var(--gray-800);
            text-align: center;
            padding: 0.6rem;
            font-weight: 600;
            font-size: 0.9rem;
            animation: promoSlide 20s linear infinite;
        }

        @keyframes promoSlide {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.8; }
        }

        /* ===== SEARCH & FILTER ===== */
        .search-filter {
            display: flex;
            gap: 1rem;
            margin-bottom: 2rem;
            background: white;
            padding: 1.5rem;
            border-radius: 16px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.05);
            flex-wrap: wrap;
        }

        .search-input {
            flex: 1;
            min-width: 200px;
            padding: 0.8rem 1.2rem;
            border: 2px solid var(--gray-200);
            border-radius: 10px;
            font-size: 1rem;
            font-family: inherit;
            outline: none;
            transition: border-color 0.3s;
        }

        .search-input:focus {
            border-color: var(--primary-blue);
        }

        .filter-select {
            padding: 0.8rem 1.2rem;
            border: 2px solid var(--gray-200);
            border-radius: 10px;
            font-size: 1rem;
            font-family: inherit;
            background: white;
            cursor: pointer;
            min-width: 180px;
        }

        /* ===== DEPARTMENT CARDS ===== */
        .departments-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .dept-card {
            padding: 1.5rem 1rem;
            border: none;
            border-radius: 16px;
            background: white;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 4px 15px rgba(0,0,0,0.05);
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.5rem;
            font-family: inherit;
        }

        .dept-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
        }

        .dept-card .icon {
            font-size: 2.5rem;
        }

        .dept-card .name {
            font-size: 0.85rem;
            font-weight: 600;
            color: var(--gray-800);
            text-align: center;
        }

        /* ===== PRODUCTS GRID ===== */
        .section-title {
            font-size: 1.4rem;
            color: var(--primary-blue);
            margin-bottom: 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 3px solid var(--primary-red);
            display: inline-block;
        }

        .products-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
            gap: 1.5rem;
        }

        .product-card {
            background: white;
            border-radius: 16px;
            overflow: hidden;
            box-shadow: 0 4px 20px rgba(0,0,0,0.06);
            transition: all 0.3s;
        }

        .product-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 30px rgba(0,0,0,0.12);
        }

        .product-image {
            height: 120px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 4rem;
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            position: relative;
        }

        .product-stock-badge {
            position: absolute;
            top: 8px;
            right: 8px;
            font-size: 0.7rem;
            padding: 0.15rem 0.5rem;
            border-radius: 20px;
            font-weight: 600;
        }

        .stock-low {
            background: #fff3cd;
            color: #856404;
        }

        .stock-out {
            background: #f8d7da;
            color: #721c24;
        }

        .product-info {
            padding: 1rem;
        }

        .product-dept {
            font-size: 0.7rem;
            padding: 0.2rem 0.6rem;
            border-radius: 20px;
            font-weight: 600;
            display: inline-block;
            margin-bottom: 0.5rem;
        }

        .product-name {
            font-size: 1rem;
            font-weight: 600;
            margin-bottom: 0.25rem;
            color: var(--gray-800);
        }

        .product-unit {
            font-size: 0.85rem;
            color: var(--gray-500);
            margin-bottom: 0.75rem;
        }

        .product-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .product-price {
            font-size: 1.3rem;
            font-weight: 700;
            color: var(--primary-blue);
        }

        .product-price .currency {
            font-size: 0.85rem;
            font-weight: 500;
        }

        .add-btn {
            padding: 0.5rem 1rem;
            border: none;
            border-radius: 8px;
            background: var(--primary-red);
            color: white;
            cursor: pointer;
            font-family: inherit;
            font-weight: 600;
            font-size: 0.85rem;
            transition: all 0.3s;
        }

        .add-btn:hover {
            background: #c41230;
            transform: scale(1.05);
        }

        .add-btn:active {
            transform: scale(0.95);
        }

        .add-btn:disabled {
            background: var(--gray-500);
            cursor: not-allowed;
            transform: none;
        }

        /* ===== CART ===== */
        .cart-container {
            max-width: 800px;
            margin: 0 auto;
        }

        .cart-empty {
            background: white;
            border-radius: 16px;
            padding: 4rem;
            text-align: center;
            box-shadow: 0 4px 20px rgba(0,0,0,0.05);
        }

        .cart-empty .icon {
            font-size: 4rem;
            margin-bottom: 1rem;
        }

        .cart-items {
            background: white;
            border-radius: 16px;
            overflow: hidden;
            box-shadow: 0 4px 20px rgba(0,0,0,0.05);
        }

        .cart-item {
            display: flex;
            align-items: center;
            padding: 1rem 1.5rem;
            gap: 1rem;
            border-bottom: 1px solid var(--gray-200);
            transition: background 0.2s;
        }

        .cart-item:hover {
            background: var(--gray-100);
        }

        .cart-item:last-child {
            border-bottom: none;
        }

        .cart-item .item-image {
            font-size: 2.5rem;
        }

        .cart-item .item-details {
            flex: 1;
        }

        .cart-item .item-name {
            font-weight: 600;
        }

        .cart-item .item-price {
            color: var(--gray-500);
            font-size: 0.9rem;
        }

        .quantity-controls {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .qty-btn {
            width: 32px;
            height: 32px;
            border: 1px solid var(--gray-200);
            border-radius: 8px;
            background: white;
            cursor: pointer;
            font-size: 1rem;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
        }

        .qty-btn:hover {
            background: var(--gray-100);
            border-color: var(--primary-blue);
        }

        .qty-value {
            width: 30px;
            text-align: center;
            font-weight: 600;
        }

        .cart-item .item-total {
            font-weight: 700;
            color: var(--primary-blue);
            min-width: 80px;
            text-align: right;
        }

        .remove-item-btn {
            background: none;
            border: none;
            color: var(--danger);
            cursor: pointer;
            font-size: 1.2rem;
            padding: 0.25rem;
            opacity: 0.6;
            transition: opacity 0.2s;
        }

        .remove-item-btn:hover {
            opacity: 1;
        }

        .cart-summary {
            background: white;
            border-radius: 16px;
            padding: 1.5rem;
            margin-top: 1rem;
            box-shadow: 0 4px 20px rgba(0,0,0,0.05);
        }

        .cart-total {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .cart-total .label {
            font-size: 1.2rem;
            font-weight: 600;
        }

        .cart-total .amount {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary-red);
        }

        .checkout-btn {
            width: 100%;
            padding: 1rem;
            border: none;
            border-radius: 12px;
            background: linear-gradient(135deg, var(--primary-blue), var(--primary-red));
            color: white;
            cursor: pointer;
            font-family: inherit;
            font-weight: 700;
            font-size: 1.1rem;
            transition: all 0.3s;
        }

        .checkout-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(27, 27, 111, 0.3);
        }

        .whatsapp-order-btn {
            width: 100%;
            padding: 1rem;
            border: none;
            border-radius: 12px;
            background: #25D366;
            color: white;
            cursor: pointer;
            font-family: inherit;
            font-weight: 700;
            font-size: 1rem;
            margin-top: 0.75rem;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }

        .whatsapp-order-btn:hover {
            background: #20bd5a;
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(37, 211, 102, 0.3);
        }

        /* ===== CHECKOUT FORM ===== */
        .checkout-container {
            max-width: 600px;
            margin: 0 auto;
        }

        .checkout-form {
            background: white;
            border-radius: 16px;
            padding: 2rem;
            box-shadow: 0 4px 20px rgba(0,0,0,0.05);
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
            color: var(--gray-800);
        }

        .form-group input,
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 0.8rem 1rem;
            border: 2px solid var(--gray-200);
            border-radius: 10px;
            font-size: 1rem;
            font-family: inherit;
            outline: none;
            transition: border-color 0.3s;
        }

        .form-group input:focus,
        .form-group textarea:focus {
            border-color: var(--primary-blue);
        }

        .form-group textarea {
            resize: vertical;
            min-height: 100px;
        }

        .payment-options {
            display: flex;
            gap: 1rem;
        }

        .payment-option {
            flex: 1;
            padding: 1rem;
            border: 2px solid var(--gray-200);
            border-radius: 12px;
            cursor: pointer;
            text-align: center;
            transition: all 0.3s;
        }

        .payment-option:hover {
            border-color: var(--primary-blue);
        }

        .payment-option.selected {
            border-color: var(--primary-blue);
            background: rgba(27, 27, 111, 0.05);
        }

        .payment-option .icon {
            font-size: 1.5rem;
            margin-bottom: 0.25rem;
        }

        .payment-option .label {
            font-weight: 500;
            font-size: 0.9rem;
        }

        .order-summary {
            margin-top: 2rem;
            padding: 1rem;
            background: var(--gray-100);
            border-radius: 12px;
        }

        .order-summary .row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 0.5rem;
        }

        .order-summary .total-row {
            border-top: 2px solid var(--gray-200);
            padding-top: 0.75rem;
            margin-top: 0.5rem;
            font-weight: 700;
            font-size: 1.2rem;
        }

        .order-summary .total-row .amount {
            color: var(--primary-red);
        }

        .place-order-btn {
            width: 100%;
            padding: 1rem;
            border: none;
            border-radius: 12px;
            background: linear-gradient(135deg, var(--success), #20c997);
            color: white;
            cursor: pointer;
            font-family: inherit;
            font-weight: 700;
            font-size: 1.1rem;
            margin-top: 1.5rem;
            transition: all 0.3s;
        }

        .place-order-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(40, 167, 69, 0.3);
        }

        .back-btn {
            width: 100%;
            padding: 0.8rem;
            border: none;
            border-radius: 12px;
            background: transparent;
            color: var(--gray-500);
            cursor: pointer;
            font-family: inherit;
            margin-top: 0.5rem;
            transition: color 0.2s;
        }

        .back-btn:hover {
            color: var(--gray-800);
        }

        /* ===== ORDER SUCCESS MODAL ===== */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            z-index: 200;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 1rem;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .modal-content {
            background: white;
            border-radius: 20px;
            padding: 3rem 2rem;
            text-align: center;
            max-width: 420px;
            width: 100%;
            animation: modalSlideUp 0.3s ease;
        }

        @keyframes modalSlideUp {
            from { transform: translateY(30px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .modal-content .success-icon {
            font-size: 4rem;
            margin-bottom: 1rem;
        }

        .modal-content h2 {
            color: var(--success);
            margin-bottom: 0.5rem;
        }

        .modal-content p {
            color: var(--gray-500);
            margin-bottom: 1.5rem;
        }

        .modal-content .order-ref {
            background: var(--gray-100);
            padding: 0.75rem;
            border-radius: 8px;
            font-weight: 700;
            font-size: 1.1rem;
            color: var(--primary-blue);
            margin-bottom: 1.5rem;
        }

        .modal-content button {
            padding: 0.8rem 2rem;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-family: inherit;
            font-weight: 600;
            font-size: 1rem;
            transition: all 0.3s;
        }

        .modal-content .continue-btn {
            background: var(--primary-blue);
            color: white;
        }

        /* ===== ADMIN ===== */
        .admin-login {
            max-width: 400px;
            margin: 2rem auto;
            background: white;
            border-radius: 16px;
            padding: 3rem;
            text-align: center;
            box-shadow: 0 4px 20px rgba(0,0,0,0.05);
        }

        .admin-login .icon {
            font-size: 4rem;
            margin-bottom: 1rem;
        }

        .admin-login h2 {
            margin-bottom: 1.5rem;
            color: var(--primary-blue);
        }

        .admin-login input {
            width: 100%;
            padding: 0.8rem 1rem;
            border: 2px solid var(--gray-200);
            border-radius: 10px;
            font-size: 1rem;
            font-family: inherit;
            margin-bottom: 1rem;
            outline: none;
        }

        .admin-login input:focus {
            border-color: var(--primary-blue);
        }

        .admin-login button {
            width: 100%;
            padding: 0.8rem;
            border: none;
            border-radius: 10px;
            background: var(--primary-blue);
            color: white;
            cursor: pointer;
            font-family: inherit;
            font-weight: 600;
            font-size: 1rem;
            transition: all 0.3s;
        }

        .admin-login button:hover {
            background: #14145a;
        }

        .admin-login .hint {
            margin-top: 1rem;
            font-size: 0.85rem;
            color: var(--gray-500);
        }

        /* Admin Dashboard Stats */
        .admin-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: white;
            border-radius: 16px;
            padding: 1.5rem;
            box-shadow: 0 4px 15px rgba(0,0,0,0.05);
            text-align: center;
        }

        .stat-card .stat-icon {
            font-size: 2rem;
            margin-bottom: 0.5rem;
        }

        .stat-card .stat-value {
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--primary-blue);
        }

        .stat-card .stat-label {
            font-size: 0.85rem;
            color: var(--gray-500);
            font-weight: 500;
        }

        .admin-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .admin-header h2 {
            font-size: 1.8rem;
            color: var(--primary-blue);
        }

        .admin-actions {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
        }

        .admin-btn {
            padding: 0.6rem 1.2rem;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-family: inherit;
            font-weight: 500;
            transition: all 0.3s;
        }

        .admin-btn.primary {
            background: var(--primary-red);
            color: white;
        }

        .admin-btn.primary:hover {
            background: #c41230;
        }

        .admin-btn.secondary {
            background: white;
            border: 1px solid var(--gray-200);
        }

        .admin-btn.secondary:hover {
            background: var(--gray-100);
        }

        .admin-btn .badge {
            background: var(--warning);
            color: var(--gray-800);
            border-radius: 50%;
            width: 20px;
            height: 20px;
            font-size: 0.7rem;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            margin-left: 0.5rem;
        }

        /* Add Product Form */
        .add-product-form {
            background: white;
            border-radius: 16px;
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: 0 4px 20px rgba(0,0,0,0.05);
        }

        .add-product-form h3 {
            margin-bottom: 1.5rem;
            color: var(--gray-800);
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 1rem;
        }

        .form-grid input,
        .form-grid select {
            padding: 0.8rem;
            border: 2px solid var(--gray-200);
            border-radius: 8px;
            font-size: 0.95rem;
            font-family: inherit;
            outline: none;
        }

        .form-grid input:focus,
        .form-grid select:focus {
            border-color: var(--primary-blue);
        }

        .add-product-btn {
            margin-top: 1rem;
            padding: 0.8rem 2rem;
            border: none;
            border-radius: 8px;
            background: var(--success);
            color: white;
            cursor: pointer;
            font-family: inherit;
            font-weight: 600;
            transition: all 0.3s;
        }

        .add-product-btn:hover {
            background: #218838;
        }

        /* Product List */
        .product-list {
            background: white;
            border-radius: 16px;
            padding: 2rem;
            box-shadow: 0 4px 20px rgba(0,0,0,0.05);
        }

        .product-list h3 {
            margin-bottom: 1.5rem;
            color: var(--gray-800);
        }

        .dept-section {
            margin-bottom: 2rem;
        }

        .dept-title {
            padding: 0.5rem 1rem;
            border-radius: 8px;
            display: inline-block;
            margin-bottom: 1rem;
            font-weight: 600;
        }

        .product-row {
            display: flex;
            align-items: center;
            padding: 0.75rem 1rem;
            background: var(--gray-100);
            border-radius: 8px;
            margin-bottom: 0.5rem;
            gap: 1rem;
            flex-wrap: wrap;
            transition: background 0.2s;
        }

        .product-row:hover {
            background: var(--gray-200);
        }

        .product-row .product-icon {
            font-size: 1.5rem;
        }

        .product-row .product-name {
            flex: 1;
            font-weight: 500;
            min-width: 120px;
        }

        .product-row .product-price {
            color: var(--primary-blue);
            font-weight: 600;
        }

        .product-row .product-stock {
            color: var(--gray-500);
            font-size: 0.85rem;
        }

        .product-row .actions {
            display: flex;
            gap: 0.5rem;
        }

        .product-row .edit-btn,
        .product-row .delete-btn {
            padding: 0.4rem 0.8rem;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-family: inherit;
            font-size: 0.8rem;
            font-weight: 500;
            transition: all 0.2s;
        }

        .product-row .edit-btn {
            background: var(--primary-blue);
            color: white;
        }

        .product-row .delete-btn {
            background: var(--danger);
            color: white;
        }

        .product-row input {
            padding: 0.4rem;
            border: 1px solid var(--gray-200);
            border-radius: 4px;
            font-family: inherit;
        }

        .product-row .save-btn {
            padding: 0.4rem 0.8rem;
            border: none;
            border-radius: 4px;
            background: var(--success);
            color: white;
            cursor: pointer;
            font-family: inherit;
            font-size: 0.8rem;
        }

        .product-row .cancel-btn {
            padding: 0.4rem 0.8rem;
            border: 1px solid var(--gray-200);
            border-radius: 4px;
            background: white;
            cursor: pointer;
            font-family: inherit;
            font-size: 0.8rem;
        }

        /* ===== ORDERS ===== */
        .orders-filter {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1.5rem;
            flex-wrap: wrap;
        }

        .orders-filter button {
            padding: 0.5rem 1rem;
            border: 1px solid var(--gray-200);
            border-radius: 8px;
            background: white;
            cursor: pointer;
            font-family: inherit;
            font-weight: 500;
            font-size: 0.85rem;
            transition: all 0.2s;
        }

        .orders-filter button.active {
            background: var(--primary-blue);
            color: white;
            border-color: var(--primary-blue);
        }

        .orders-list {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .order-card {
            background: white;
            border-radius: 16px;
            overflow: hidden;
            box-shadow: 0 4px 20px rgba(0,0,0,0.05);
        }

        .order-header {
            padding: 1rem 1.5rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 0.5rem;
        }

        .order-header.pending { background: #fff3cd; }
        .order-header.processing { background: #d1ecf1; }
        .order-header.completed { background: #d4edda; }
        .order-header.cancelled { background: #f8d7da; }

        .order-id {
            font-weight: 700;
            font-size: 1.1rem;
        }

        .order-date {
            color: var(--gray-500);
            font-size: 0.9rem;
            margin-left: 1rem;
        }

        .order-status {
            padding: 0.3rem 0.8rem;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            color: white;
            text-transform: uppercase;
        }

        .order-status.pending { background: var(--warning); color: var(--gray-800); }
        .order-status.processing { background: var(--info); }
        .order-status.completed { background: var(--success); }
        .order-status.cancelled { background: var(--danger); }

        .order-body {
            padding: 1.5rem;
        }

        .order-info {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .order-info .info-label {
            font-size: 0.85rem;
            color: var(--gray-500);
            font-weight: 600;
        }

        .order-info .info-value {
            margin-top: 0.25rem;
        }

        .order-items {
            background: var(--gray-100);
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 1rem;
        }

        .order-items .title {
            font-weight: 600;
            font-size: 0.9rem;
            margin-bottom: 0.5rem;
        }

        .order-item-row {
            display: flex;
            justify-content: space-between;
            padding: 0.3rem 0;
            border-bottom: 1px solid var(--gray-200);
        }

        .order-item-row:last-child {
            border-bottom: none;
        }

        .order-total-row {
            display: flex;
            justify-content: space-between;
            padding-top: 0.5rem;
            font-weight: 700;
            font-size: 1.1rem;
        }

        .order-total-row .amount {
            color: var(--primary-red);
        }

        .order-actions {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
        }

        .order-actions button {
            padding: 0.5rem 1rem;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-family: inherit;
            font-weight: 500;
            transition: all 0.3s;
        }

        .order-actions .process-btn { background: var(--info); color: white; }
        .order-actions .complete-btn { background: var(--success); color: white; }
        .order-actions .cancel-btn { background: var(--danger); color: white; }
        .order-actions .delete-btn { background: white; border: 1px solid var(--gray-200); }

        /* ===== NOTIFICATION ===== */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 1rem 1.5rem;
            border-radius: 12px;
            color: white;
            box-shadow: 0 4px 20px rgba(0,0,0,0.2);
            z-index: 1000;
            animation: slideIn 0.3s ease;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            max-width: 350px;
        }

        .notification.success { background: var(--success); }
        .notification.error { background: var(--danger); }

        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        /* ===== WHATSAPP FLOATING BUTTON ===== */
        .whatsapp-float {
            position: fixed;
            bottom: 24px;
            right: 24px;
            width: 60px;
            height: 60px;
            background: #25D366;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            box-shadow: 0 4px 20px rgba(37, 211, 102, 0.4);
            z-index: 90;
            cursor: pointer;
            transition: all 0.3s;
            text-decoration: none;
            color: white;
        }

        .whatsapp-float:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 25px rgba(37, 211, 102, 0.5);
        }

        .whatsapp-float .tooltip {
            position: absolute;
            right: 70px;
            background: white;
            color: var(--gray-800);
            padding: 0.5rem 1rem;
            border-radius: 8px;
            font-size: 0.85rem;
            font-weight: 500;
            white-space: nowrap;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.2s;
        }

        .whatsapp-float:hover .tooltip {
            opacity: 1;
        }

        /* ===== FOOTER ===== */
        footer {
            background: var(--primary-blue);
            color: white;
            padding: 3rem 5%;
            margin-top: 4rem;
        }

        .footer-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 2rem;
            max-width: 1400px;
            margin: 0 auto;
        }

        .footer-brand {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 1rem;
        }

        .footer-brand span {
            color: var(--primary-red);
        }

        footer h4 {
            margin-bottom: 1rem;
            font-size: 1.1rem;
        }

        footer p, footer a {
            opacity: 0.8;
            margin-bottom: 0.5rem;
            display: block;
            color: white;
            text-decoration: none;
            font-size: 0.95rem;
        }

        footer a:hover {
            opacity: 1;
        }

        .footer-bottom {
            border-top: 1px solid rgba(255,255,255,0.2);
            margin-top: 2rem;
            padding-top: 2rem;
            text-align: center;
            opacity: 0.7;
            font-size: 0.9rem;
        }

        /* ===== UTILITIES ===== */
        .empty-state {
            text-align: center;
            padding: 4rem;
            color: var(--gray-500);
        }

        .empty-state .icon {
            font-size: 4rem;
            margin-bottom: 1rem;
        }

        .page-title {
            font-size: 1.8rem;
            color: var(--primary-blue);
            margin-bottom: 1.5rem;
        }

        .hidden {
            display: none !important;
        }

        /* ===== RESPONSIVE ===== */
        @media (max-width: 768px) {
            .header {
                padding: 1rem 3%;
            }

            main {
                padding: 1rem 3%;
            }

            .hero-banner {
                padding: 2rem 1.5rem;
            }

            .hero-banner h1 {
                font-size: 1.6rem;
            }

            .hero-features {
                gap: 1rem;
            }

            .hero-feature {
                font-size: 0.8rem;
            }

            .cart-item {
                flex-wrap: wrap;
            }

            .order-info {
                grid-template-columns: 1fr;
            }

            .payment-options {
                flex-direction: column;
            }

            .admin-stats {
                grid-template-columns: repeat(2, 1fr);
            }

            .whatsapp-float {
                bottom: 16px;
                right: 16px;
                width: 52px;
                height: 52px;
                font-size: 1.7rem;
            }
        }

        @media (max-width: 480px) {
            .logo-text {
                font-size: 1.2rem;
            }

            .nav-btn {
                padding: 0.5rem 0.8rem;
                font-size: 0.8rem;
            }

            .products-grid {
                grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
                gap: 1rem;
            }

            .departments-grid {
                grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
            }
        }

        /* ===== SCROLL TO TOP ===== */
        .scroll-top {
            position: fixed;
            bottom: 24px;
            left: 24px;
            width: 44px;
            height: 44px;
            background: var(--primary-blue);
            color: white;
            border: none;
            border-radius: 50%;
            display: none;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            cursor: pointer;
            z-index: 90;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
            transition: all 0.3s;
        }

        .scroll-top:hover {
            background: var(--primary-red);
            transform: translateY(-2px);
        }

        .scroll-top.visible {
            display: flex;
        }

        /* ===== LOADING SKELETON ===== */
        @keyframes shimmer {
            0% { background-position: -200px 0; }
            100% { background-position: 200px 0; }
        }
    </style>
</head>
<body>
    <!-- Notification -->
    <div id="notification" class="notification hidden"></div>

    <!-- Order Success Modal -->
    <div id="order-success-modal" class="modal-overlay hidden" onclick="closeModal(event)">
        <div class="modal-content">
            <div class="success-icon">&#10003;</div>
            <h2>Order Placed!</h2>
            <p>Your order has been received. We will contact you shortly to confirm delivery.</p>
            <div class="order-ref" id="modal-order-ref"></div>
            <p style="font-size: 0.9rem;">Save this reference number for tracking.</p>
            <button class="continue-btn" onclick="closeModalAndShop()">Continue Shopping</button>
        </div>
    </div>

    <!-- Promo Bar -->
    <div class="promo-bar">
        &#127881; FREE delivery on orders over KSh 2,000 within Kakamega! &#127881;
    </div>

    <!-- Header -->
    <header class="header">
        <div class="logo" onclick="showView('store')">
            <div class="logo-icon">&#128722;</div>
            <div>
                <div class="logo-text">Maisha<span>Mart</span></div>
                <div class="logo-tagline">Where life begins</div>
            </div>
        </div>
        <div class="nav-buttons">
            <button class="nav-btn active" id="nav-store" onclick="showView('store')">&#127978; Shop</button>
            <button class="nav-btn cart-btn" id="nav-cart" onclick="showView('cart')">
                &#128722; Cart
                <span class="cart-badge hidden" id="cart-badge">0</span>
            </button>
            <button class="nav-btn" id="nav-admin" onclick="showView('admin')">&#9881; Admin</button>
        </div>
    </header>

    <!-- Main Content -->
    <main>
        <!-- Store View -->
        <div id="store-view">
            <div class="hero-banner">
                <h1>Welcome to Maisha Mart</h1>
                <p>Quality products at affordable prices &bull; Kakamega's favorite supermarket</p>
                <div class="hero-features">
                    <div class="hero-feature"><span class="icon">&#128666;</span> Free Delivery</div>
                    <div class="hero-feature"><span class="icon">&#128178;</span> M-Pesa Accepted</div>
                    <div class="hero-feature"><span class="icon">&#9989;</span> Fresh Daily</div>
                    <div class="hero-feature"><span class="icon">&#128222;</span> Call to Order</div>
                </div>
            </div>

            <div class="search-filter">
                <input type="text" class="search-input" id="search-input" placeholder="&#128269; Search products..." oninput="filterProducts()">
                <select class="filter-select" id="dept-filter" onchange="filterProducts()">
                    <option value="all">All Departments</option>
                </select>
                <select class="filter-select" id="sort-filter" onchange="filterProducts()">
                    <option value="default">Sort By</option>
                    <option value="price-low">Price: Low to High</option>
                    <option value="price-high">Price: High to Low</option>
                    <option value="name-az">Name: A to Z</option>
                </select>
            </div>

            <div class="departments-grid" id="departments-grid"></div>
            <div id="products-section-title"></div>
            <div class="products-grid" id="products-grid"></div>
        </div>

        <!-- Cart View -->
        <div id="cart-view" class="hidden">
            <h2 class="page-title">&#128722; Your Cart</h2>
            <div class="cart-container" id="cart-container"></div>
        </div>

        <!-- Checkout View -->
        <div id="checkout-view" class="hidden">
            <h2 class="page-title">&#128230; Checkout</h2>
            <div class="checkout-container">
                <div class="checkout-form">
                    <h3>Delivery Details</h3>
                    <div class="form-group">
                        <label>Full Name *</label>
                        <input type="text" id="checkout-name" placeholder="e.g. John Ochieng">
                    </div>
                    <div class="form-group">
                        <label>Phone Number (M-Pesa) *</label>
                        <input type="tel" id="checkout-phone" placeholder="e.g. 0712 345 678">
                    </div>
                    <div class="form-group">
                        <label>Delivery Area *</label>
                        <select id="checkout-area">
                            <option value="">Select delivery area...</option>
                            <option value="Kakamega Town">Kakamega Town</option>
                            <option value="Lurambi">Lurambi</option>
                            <option value="Milimani">Milimani</option>
                            <option value="Amalemba">Amalemba</option>
                            <option value="Shirere">Shirere</option>
                            <option value="Mahiakalo">Mahiakalo</option>
                            <option value="Mumias Road">Mumias Road</option>
                            <option value="Other">Other (specify below)</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Delivery Address / Landmark *</label>
                        <textarea id="checkout-address" placeholder="Enter specific location, nearest landmark, or building name"></textarea>
                    </div>
                    <div class="form-group">
                        <label>Delivery Notes (optional)</label>
                        <input type="text" id="checkout-notes" placeholder="e.g. Call when arriving, gate code, etc.">
                    </div>
                    <div class="form-group">
                        <label>Payment Method</label>
                        <div class="payment-options">
                            <div class="payment-option selected" data-method="mpesa" onclick="selectPayment('mpesa')">
                                <div class="icon">&#128241;</div>
                                <div class="label">M-Pesa</div>
                            </div>
                            <div class="payment-option" data-method="cash" onclick="selectPayment('cash')">
                                <div class="icon">&#128181;</div>
                                <div class="label">Cash on Delivery</div>
                            </div>
                        </div>
                    </div>
                    <div class="order-summary" id="checkout-summary"></div>
                    <button class="place-order-btn" onclick="placeOrder()">&#10003; Place Order</button>
                    <button class="back-btn" onclick="showView('cart')">&larr; Back to Cart</button>
                </div>
            </div>
        </div>

        <!-- Admin Login -->
        <div id="admin-login" class="hidden">
            <div class="admin-login">
                <div class="icon">&#128274;</div>
                <h2>Admin Login</h2>
                <input type="password" id="admin-password" placeholder="Enter admin password" onkeypress="if(event.key==='Enter')adminLogin()">
                <button onclick="adminLogin()">Login</button>
                <p class="hint">Default password: maisha2024</p>
            </div>
        </div>

        <!-- Admin Panel -->
        <div id="admin-panel" class="hidden">
            <div class="admin-header">
                <h2>&#9881; Admin Dashboard</h2>
                <div class="admin-actions">
                    <button class="admin-btn primary" onclick="showView('orders')">
                        &#128203; View Orders
                        <span class="badge hidden" id="pending-orders-badge">0</span>
                    </button>
                    <button class="admin-btn secondary" onclick="exportOrders()">&#128196; Export Orders</button>
                    <button class="admin-btn secondary" onclick="adminLogout()">Logout</button>
                </div>
            </div>

            <!-- Dashboard Stats -->
            <div class="admin-stats" id="admin-stats"></div>

            <div class="add-product-form">
                <h3>&#10133; Add New Product</h3>
                <div class="form-grid">
                    <input type="text" id="new-product-name" placeholder="Product Name">
                    <input type="number" id="new-product-price" placeholder="Price (KSh)" min="0">
                    <select id="new-product-unit">
                        <option value="kg">per kg</option>
                        <option value="pc">per piece</option>
                        <option value="pack">per pack</option>
                        <option value="bunch">per bunch</option>
                        <option value="loaf">per loaf</option>
                        <option value="tray">per tray</option>
                        <option value="bottle">per bottle</option>
                        <option value="litre">per litre</option>
                    </select>
                    <input type="number" id="new-product-stock" placeholder="Stock Quantity" min="0">
                    <select id="new-product-dept"></select>
                    <select id="new-product-icon">
                        <option value="&#128230;">&#128230; Box</option>
                        <option value="&#127813;">&#127813; Tomato</option>
                        <option value="&#129477;">&#129477; Onion</option>
                        <option value="&#129468;">&#129468; Leafy</option>
                        <option value="&#129365;">&#129365; Carrot</option>
                        <option value="&#129364;">&#129364; Potato</option>
                        <option value="&#127820;">&#127820; Banana</option>
                        <option value="&#127818;">&#127818; Orange</option>
                        <option value="&#129389;">&#129389; Mango</option>
                        <option value="&#127822;">&#127822; Apple</option>
                        <option value="&#129371;">&#129371; Milk</option>
                        <option value="&#129472;">&#129472; Cheese</option>
                        <option value="&#129370;">&#129370; Egg</option>
                        <option value="&#129385;">&#129385; Meat</option>
                        <option value="&#127831;">&#127831; Chicken</option>
                        <option value="&#128031;">&#128031; Fish</option>
                        <option value="&#127838;">&#127838; Bread</option>
                        <option value="&#127874;">&#127874; Cake</option>
                        <option value="&#129380;">&#129380; Drink</option>
                        <option value="&#128167;">&#128167; Water</option>
                        <option value="&#129475;">&#129475; Juice</option>
                        <option value="&#129527;">&#129527; Oil</option>
                        <option value="&#129474;">&#129474; Salt/Sugar</option>
                        <option value="&#127834;">&#127834; Rice</option>
                        <option value="&#128268;">&#128268; Electric</option>
                        <option value="&#127911;">&#127911; Audio</option>
                        <option value="&#128161;">&#128161; Light</option>
                    </select>
                </div>
                <button class="add-product-btn" onclick="addProduct()">Add Product</button>
            </div>

            <div class="product-list">
                <h3>&#128203; Manage Products</h3>
                <div id="admin-products-list"></div>
            </div>
        </div>

        <!-- Orders View -->
        <div id="orders-view" class="hidden">
            <div class="admin-header">
                <h2>&#128203; Customer Orders</h2>
                <button class="admin-btn secondary" onclick="showView('admin')">&larr; Back to Admin</button>
            </div>
            <div class="orders-filter" id="orders-filter">
                <button class="active" onclick="filterOrders('all', this)">All</button>
                <button onclick="filterOrders('pending', this)">Pending</button>
                <button onclick="filterOrders('processing', this)">Processing</button>
                <button onclick="filterOrders('completed', this)">Completed</button>
                <button onclick="filterOrders('cancelled', this)">Cancelled</button>
            </div>
            <div class="orders-list" id="orders-list"></div>
        </div>
    </main>

    <!-- WhatsApp Floating Button -->
    <a class="whatsapp-float" href="https://wa.me/254712983969?text=Hi%20Maisha%20Mart!%20I%20would%20like%20to%20place%20an%20order." target="_blank" rel="noopener">
        &#128172;
        <span class="tooltip">Chat with us on WhatsApp</span>
    </a>

    <!-- Scroll to Top -->
    <button class="scroll-top" id="scroll-top" onclick="window.scrollTo({top:0,behavior:'smooth'})">&#8593;</button>

    <!-- Footer -->
    <footer>
        <div class="footer-grid">
            <div>
                <div class="footer-brand">Maisha<span>Mart</span></div>
                <p>Where life begins. Your trusted supermarket in Kakamega, providing quality products at affordable prices since day one.</p>
            </div>
            <div>
                <h4>Contact Us</h4>
                <a href="tel:+254712983969">&#128222; +254 712 983 969</a>
                <a href="tel:+254773100700">&#128222; +254 773 100 700</a>
                <a href="https://wa.me/254712983969" target="_blank" rel="noopener">&#128172; WhatsApp Us</a>
                <p>&#128205; Kakamega, Kenya</p>
            </div>
            <div>
                <h4>Store Hours</h4>
                <p>Monday - Saturday</p>
                <p><strong>7:00 AM - 9:00 PM</strong></p>
                <p>Sunday</p>
                <p><strong>8:00 AM - 8:00 PM</strong></p>
            </div>
            <div>
                <h4>Follow Us</h4>
                <a href="https://www.facebook.com/maishamartsupermarket/" target="_blank" rel="noopener">&#128216; Facebook Page</a>
                <p style="margin-top: 1rem; font-size: 0.85rem; opacity: 0.6;">Developed with &#10084; for Maisha Mart</p>
            </div>
        </div>
        <div class="footer-bottom">
            &copy; 2025 Maisha Mart Supermarket. All rights reserved.
        </div>
    </footer>

    <script>
    // ==========================================
    // MAISHA MART SUPERMARKET - ONLINE STORE
    // ==========================================

    // ==================== DATA ====================
    const departmentInfo = {
        vegetables: { name: 'Fresh Vegetables', icon: '\u{1F96C}', color: '#2D6A4F' },
        fruits:     { name: 'Fresh Fruits',     icon: '\u{1F34E}', color: '#E85D04' },
        dairy:      { name: 'Dairy & Eggs',     icon: '\u{1F95B}', color: '#4895EF' },
        meat:       { name: 'Meat & Fish',      icon: '\u{1F969}', color: '#9D4EDD' },
        bakery:     { name: 'Bakery',           icon: '\u{1F35E}', color: '#F48C06' },
        beverages:  { name: 'Beverages',        icon: '\u{1F964}', color: '#E63946' },
        household:  { name: 'Household & Groceries', icon: '\u{1F3E0}', color: '#457B9D' },
        electronics:{ name: 'Electronics',      icon: '\u{1F4F1}', color: '#1D3557' }
    };

    const defaultProducts = {
        vegetables: [
            { id: 'veg-1', name: 'Tomatoes', price: 80, unit: 'kg', image: '\u{1F345}', stock: 100 },
            { id: 'veg-2', name: 'Onions', price: 60, unit: 'kg', image: '\u{1F9C5}', stock: 150 },
            { id: 'veg-3', name: 'Cabbage', price: 50, unit: 'pc', image: '\u{1F96C}', stock: 80 },
            { id: 'veg-4', name: 'Carrots', price: 70, unit: 'kg', image: '\u{1F955}', stock: 90 },
            { id: 'veg-5', name: 'Spinach', price: 30, unit: 'bunch', image: '\u{1F957}', stock: 60 },
            { id: 'veg-6', name: 'Potatoes', price: 55, unit: 'kg', image: '\u{1F954}', stock: 200 },
            { id: 'veg-7', name: 'Green Peppers', price: 120, unit: 'kg', image: '\u{1FAD1}', stock: 50 },
            { id: 'veg-8', name: 'Sukuma Wiki', price: 20, unit: 'bunch', image: '\u{1F96C}', stock: 100 }
        ],
        fruits: [
            { id: 'fru-1', name: 'Bananas', price: 100, unit: 'bunch', image: '\u{1F34C}', stock: 80 },
            { id: 'fru-2', name: 'Oranges', price: 10, unit: 'pc', image: '\u{1F34A}', stock: 200 },
            { id: 'fru-3', name: 'Mangoes', price: 30, unit: 'pc', image: '\u{1F96D}', stock: 100 },
            { id: 'fru-4', name: 'Apples', price: 25, unit: 'pc', image: '\u{1F34E}', stock: 150 },
            { id: 'fru-5', name: 'Watermelon', price: 150, unit: 'pc', image: '\u{1F349}', stock: 40 },
            { id: 'fru-6', name: 'Pineapple', price: 100, unit: 'pc', image: '\u{1F34D}', stock: 50 },
            { id: 'fru-7', name: 'Avocados', price: 20, unit: 'pc', image: '\u{1F951}', stock: 120 },
            { id: 'fru-8', name: 'Pawpaw', price: 80, unit: 'pc', image: '\u{1F348}', stock: 45 }
        ],
        dairy: [
            { id: 'dai-1', name: 'Fresh Milk (500ml)', price: 60, unit: 'pc', image: '\u{1F95B}', stock: 100 },
            { id: 'dai-2', name: 'Yoghurt', price: 80, unit: 'pc', image: '\u{1F95B}', stock: 80 },
            { id: 'dai-3', name: 'Cheese (250g)', price: 350, unit: 'pc', image: '\u{1F9C0}', stock: 40 },
            { id: 'dai-4', name: 'Butter (500g)', price: 450, unit: 'pc', image: '\u{1F9C8}', stock: 50 },
            { id: 'dai-5', name: 'Eggs (Tray)', price: 450, unit: 'tray', image: '\u{1F95A}', stock: 60 },
            { id: 'dai-6', name: 'Cream (250ml)', price: 180, unit: 'pc', image: '\u{1F95B}', stock: 30 }
        ],
        meat: [
            { id: 'mea-1', name: 'Beef', price: 650, unit: 'kg', image: '\u{1F969}', stock: 50 },
            { id: 'mea-2', name: 'Chicken', price: 550, unit: 'kg', image: '\u{1F357}', stock: 60 },
            { id: 'mea-3', name: 'Goat Meat', price: 750, unit: 'kg', image: '\u{1F969}', stock: 40 },
            { id: 'mea-4', name: 'Fish (Tilapia)', price: 450, unit: 'kg', image: '\u{1F41F}', stock: 35 },
            { id: 'mea-5', name: 'Sausages (500g)', price: 320, unit: 'pack', image: '\u{1F32D}', stock: 70 },
            { id: 'mea-6', name: 'Bacon (200g)', price: 380, unit: 'pack', image: '\u{1F953}', stock: 45 }
        ],
        bakery: [
            { id: 'bak-1', name: 'White Bread', price: 60, unit: 'loaf', image: '\u{1F35E}', stock: 100 },
            { id: 'bak-2', name: 'Brown Bread', price: 65, unit: 'loaf', image: '\u{1F35E}', stock: 80 },
            { id: 'bak-3', name: 'Cakes', price: 500, unit: 'pc', image: '\u{1F382}', stock: 20 },
            { id: 'bak-4', name: 'Mandazi (6pc)', price: 50, unit: 'pack', image: '\u{1F96F}', stock: 60 },
            { id: 'bak-5', name: 'Doughnuts', price: 30, unit: 'pc', image: '\u{1F369}', stock: 80 },
            { id: 'bak-6', name: 'Chapati', price: 20, unit: 'pc', image: '\u{1FAD3}', stock: 100 }
        ],
        beverages: [
            { id: 'bev-1', name: 'Coca Cola (500ml)', price: 70, unit: 'pc', image: '\u{1F964}', stock: 200 },
            { id: 'bev-2', name: 'Fanta (500ml)', price: 70, unit: 'pc', image: '\u{1F964}', stock: 180 },
            { id: 'bev-3', name: 'Mineral Water (1L)', price: 50, unit: 'pc', image: '\u{1F4A7}', stock: 250 },
            { id: 'bev-4', name: 'Juice (1L)', price: 180, unit: 'pc', image: '\u{1F9C3}', stock: 100 },
            { id: 'bev-5', name: 'Tea Leaves (500g)', price: 350, unit: 'pack', image: '\u{1F375}', stock: 80 },
            { id: 'bev-6', name: 'Coffee (250g)', price: 450, unit: 'pack', image: '\u2615', stock: 60 }
        ],
        household: [
            { id: 'hou-1', name: 'Cooking Oil (1L)', price: 350, unit: 'pc', image: '\u{1FAD7}', stock: 100 },
            { id: 'hou-2', name: 'Sugar (1kg)', price: 180, unit: 'kg', image: '\u{1F9C2}', stock: 150 },
            { id: 'hou-3', name: 'Salt (1kg)', price: 45, unit: 'kg', image: '\u{1F9C2}', stock: 200 },
            { id: 'hou-4', name: 'Maize Flour (2kg)', price: 180, unit: 'pack', image: '\u{1F33D}', stock: 120 },
            { id: 'hou-5', name: 'Rice (1kg)', price: 150, unit: 'kg', image: '\u{1F35A}', stock: 100 },
            { id: 'hou-6', name: 'Wheat Flour (2kg)', price: 200, unit: 'pack', image: '\u{1F33E}', stock: 90 },
            { id: 'hou-7', name: 'Soap (Bar)', price: 80, unit: 'pc', image: '\u{1F9FC}', stock: 200 },
            { id: 'hou-8', name: 'Detergent (1kg)', price: 250, unit: 'pack', image: '\u{1F9F4}', stock: 80 }
        ],
        electronics: [
            { id: 'ele-1', name: 'Phone Charger', price: 500, unit: 'pc', image: '\u{1F50C}', stock: 50 },
            { id: 'ele-2', name: 'Earphones', price: 300, unit: 'pc', image: '\u{1F3A7}', stock: 60 },
            { id: 'ele-3', name: 'Power Bank', price: 2500, unit: 'pc', image: '\u{1F50B}', stock: 30 },
            { id: 'ele-4', name: 'LED Bulb', price: 150, unit: 'pc', image: '\u{1F4A1}', stock: 100 },
            { id: 'ele-5', name: 'Extension Cable', price: 800, unit: 'pc', image: '\u{1F50C}', stock: 40 },
            { id: 'ele-6', name: 'Torch/Flashlight', price: 350, unit: 'pc', image: '\u{1F526}', stock: 55 }
        ]
    };

    // ==================== STATE ====================
    let products = {};
    let orders = [];
    let cart = [];
    let isAdmin = false;
    let editingProductId = null;
    let selectedPayment = 'mpesa';
    let currentOrderFilter = 'all';

    // ==================== STORAGE ====================
    function saveData() {
        localStorage.setItem('maishaMart_products', JSON.stringify(products));
        localStorage.setItem('maishaMart_orders', JSON.stringify(orders));
        localStorage.setItem('maishaMart_cart', JSON.stringify(cart));
    }

    function loadData() {
        const savedProducts = localStorage.getItem('maishaMart_products');
        const savedOrders = localStorage.getItem('maishaMart_orders');
        const savedCart = localStorage.getItem('maishaMart_cart');

        products = savedProducts ? JSON.parse(savedProducts) : JSON.parse(JSON.stringify(defaultProducts));
        orders = savedOrders ? JSON.parse(savedOrders) : [];
        cart = savedCart ? JSON.parse(savedCart) : [];
    }

    // ==================== NOTIFICATIONS ====================
    function showNotification(message, type = 'success') {
        const notif = document.getElementById('notification');
        notif.innerHTML = (type === 'success' ? '&#10003; ' : '&#10007; ') + message;
        notif.className = 'notification ' + type;
        notif.classList.remove('hidden');

        setTimeout(function() {
            notif.classList.add('hidden');
        }, 3000);
    }

    // ==================== MODAL ====================
    function showOrderSuccessModal(orderId) {
        document.getElementById('modal-order-ref').textContent = orderId;
        document.getElementById('order-success-modal').classList.remove('hidden');
    }

    function closeModal(event) {
        if (event.target === event.currentTarget) {
            document.getElementById('order-success-modal').classList.add('hidden');
        }
    }

    function closeModalAndShop() {
        document.getElementById('order-success-modal').classList.add('hidden');
        showView('store');
    }

    // ==================== NAVIGATION ====================
    function showView(view) {
        var views = ['store-view', 'cart-view', 'checkout-view', 'admin-login', 'admin-panel', 'orders-view'];
        views.forEach(function(v) {
            document.getElementById(v).classList.add('hidden');
        });

        document.querySelectorAll('.nav-btn').forEach(function(btn) {
            btn.classList.remove('active');
        });

        switch(view) {
            case 'store':
                document.getElementById('store-view').classList.remove('hidden');
                document.getElementById('nav-store').classList.add('active');
                break;
            case 'cart':
                document.getElementById('cart-view').classList.remove('hidden');
                document.getElementById('nav-cart').classList.add('active');
                renderCart();
                break;
            case 'checkout':
                document.getElementById('checkout-view').classList.remove('hidden');
                document.getElementById('nav-cart').classList.add('active');
                renderCheckoutSummary();
                break;
            case 'admin':
                if (isAdmin) {
                    document.getElementById('admin-panel').classList.remove('hidden');
                    renderAdminProducts();
                    renderAdminStats();
                    updatePendingOrdersBadge();
                } else {
                    document.getElementById('admin-login').classList.remove('hidden');
                }
                document.getElementById('nav-admin').classList.add('active');
                break;
            case 'orders':
                document.getElementById('orders-view').classList.remove('hidden');
                document.getElementById('nav-admin').classList.add('active');
                renderOrders();
                break;
        }

        window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    // ==================== STORE ====================
    function renderDepartments() {
        var grid = document.getElementById('departments-grid');
        var filterSelect = document.getElementById('dept-filter');
        var adminDeptSelect = document.getElementById('new-product-dept');

        grid.innerHTML = '';
        adminDeptSelect.innerHTML = '';

        Object.entries(departmentInfo).forEach(function(entry) {
            var key = entry[0];
            var info = entry[1];
            var count = (products[key] || []).length;

            grid.innerHTML += '<button class="dept-card" onclick="selectDepartment(\'' + key + '\')">' +
                '<span class="icon">' + info.icon + '</span>' +
                '<span class="name">' + info.name + '</span>' +
                '</button>';

            if (!filterSelect.querySelector('option[value="' + key + '"]')) {
                filterSelect.innerHTML += '<option value="' + key + '">' + info.icon + ' ' + info.name + '</option>';
            }

            adminDeptSelect.innerHTML += '<option value="' + key + '">' + info.name + '</option>';
        });
    }

    function selectDepartment(dept) {
        document.getElementById('dept-filter').value = dept;
        filterProducts();
    }

    function filterProducts() {
        var searchQuery = document.getElementById('search-input').value.toLowerCase();
        var selectedDept = document.getElementById('dept-filter').value;
        var sortBy = document.getElementById('sort-filter').value;

        var filteredProducts = [];

        if (selectedDept === 'all') {
            Object.entries(products).forEach(function(entry) {
                var dept = entry[0];
                var items = entry[1];
                items.forEach(function(item) {
                    filteredProducts.push(Object.assign({}, item, { department: dept }));
                });
            });
        } else {
            (products[selectedDept] || []).forEach(function(item) {
                filteredProducts.push(Object.assign({}, item, { department: selectedDept }));
            });
        }

        if (searchQuery) {
            filteredProducts = filteredProducts.filter(function(p) {
                return p.name.toLowerCase().includes(searchQuery);
            });
        }

        // Sort
        if (sortBy === 'price-low') {
            filteredProducts.sort(function(a, b) { return a.price - b.price; });
        } else if (sortBy === 'price-high') {
            filteredProducts.sort(function(a, b) { return b.price - a.price; });
        } else if (sortBy === 'name-az') {
            filteredProducts.sort(function(a, b) { return a.name.localeCompare(b.name); });
        }

        renderProducts(filteredProducts);

        // Show/hide departments grid
        var deptsGrid = document.getElementById('departments-grid');
        var titleEl = document.getElementById('products-section-title');
        if (selectedDept === 'all' && !searchQuery) {
            deptsGrid.classList.remove('hidden');
            titleEl.innerHTML = '';
        } else {
            deptsGrid.classList.add('hidden');
            var label = selectedDept !== 'all' ? departmentInfo[selectedDept].name : 'Search Results';
            titleEl.innerHTML = '<h3 class="section-title">' + label + ' (' + filteredProducts.length + ')</h3>';
        }
    }

    function renderProducts(productsList) {
        var grid = document.getElementById('products-grid');

        if (productsList.length === 0) {
            grid.innerHTML = '<div class="empty-state" style="grid-column:1/-1;">' +
                '<div class="icon">\u{1F50D}</div>' +
                '<p>No products found. Try a different search or category.</p>' +
                '</div>';
            return;
        }

        grid.innerHTML = productsList.map(function(product) {
            var deptInfo = departmentInfo[product.department];
            var stockBadge = '';
            if (product.stock <= 0) {
                stockBadge = '<span class="product-stock-badge stock-out">Out of Stock</span>';
            } else if (product.stock <= 10) {
                stockBadge = '<span class="product-stock-badge stock-low">Low Stock</span>';
            }
            var disabled = product.stock <= 0 ? ' disabled' : '';
            var btnText = product.stock <= 0 ? 'Sold Out' : '+ Add';

            return '<div class="product-card">' +
                '<div class="product-image" style="background:' + deptInfo.color + '15;">' +
                    product.image + stockBadge +
                '</div>' +
                '<div class="product-info">' +
                    '<span class="product-dept" style="background:' + deptInfo.color + '20;color:' + deptInfo.color + ';">' + deptInfo.name + '</span>' +
                    '<h3 class="product-name">' + product.name + '</h3>' +
                    '<p class="product-unit">per ' + product.unit + '</p>' +
                    '<div class="product-footer">' +
                        '<span class="product-price"><span class="currency">KSh</span> ' + product.price.toLocaleString() + '</span>' +
                        '<button class="add-btn"' + disabled + ' onclick="addToCart(\'' + product.id + '\', \'' + product.department + '\')">' + btnText + '</button>' +
                    '</div>' +
                '</div>' +
            '</div>';
        }).join('');
    }

    // ==================== CART ====================
    function addToCart(productId, department) {
        var product = products[department].find(function(p) { return p.id === productId; });
        if (!product || product.stock <= 0) return;

        var existingItem = cart.find(function(item) { return item.id === productId; });
        if (existingItem) {
            if (existingItem.quantity >= product.stock) {
                showNotification('Maximum available stock reached', 'error');
                return;
            }
            existingItem.quantity++;
        } else {
            cart.push(Object.assign({}, product, { quantity: 1, department: department }));
        }

        updateCartBadge();
        saveData();
        showNotification(product.name + ' added to cart!');
    }

    function updateCartQuantity(productId, change) {
        var item = cart.find(function(i) { return i.id === productId; });
        if (!item) return;

        item.quantity += change;
        if (item.quantity <= 0) {
            cart = cart.filter(function(i) { return i.id !== productId; });
        }

        updateCartBadge();
        saveData();
        renderCart();
    }

    function removeFromCart(productId) {
        cart = cart.filter(function(i) { return i.id !== productId; });
        updateCartBadge();
        saveData();
        renderCart();
    }

    function clearCart() {
        if (cart.length === 0) return;
        if (!confirm('Remove all items from cart?')) return;
        cart = [];
        updateCartBadge();
        saveData();
        renderCart();
    }

    function updateCartBadge() {
        var badge = document.getElementById('cart-badge');
        var totalItems = cart.reduce(function(sum, item) { return sum + item.quantity; }, 0);
        if (totalItems > 0) {
            badge.textContent = totalItems;
            badge.classList.remove('hidden');
        } else {
            badge.classList.add('hidden');
        }
    }

    function getCartTotal() {
        return cart.reduce(function(sum, item) { return sum + (item.price * item.quantity); }, 0);
    }

    function generateWhatsAppOrder() {
        var message = '*New Order from Maisha Mart Website*\n\n';
        cart.forEach(function(item) {
            message += item.image + ' ' + item.name + ' x' + item.quantity + ' = KSh ' + (item.price * item.quantity).toLocaleString() + '\n';
        });
        message += '\n*Total: KSh ' + getCartTotal().toLocaleString() + '*';
        message += '\n\nPlease confirm my order. Thank you!';
        return 'https://wa.me/254712983969?text=' + encodeURIComponent(message);
    }

    function renderCart() {
        var container = document.getElementById('cart-container');

        if (cart.length === 0) {
            container.innerHTML = '<div class="cart-empty">' +
                '<div class="icon">\u{1F6D2}</div>' +
                '<h3>Your cart is empty</h3>' +
                '<p style="color:var(--gray-500);margin:0.5rem 0 1.5rem;">Browse our products and add items to get started</p>' +
                '<button class="nav-btn active" onclick="showView(\'store\')">Start Shopping</button>' +
                '</div>';
            return;
        }

        var itemsHtml = cart.map(function(item) {
            return '<div class="cart-item">' +
                '<span class="item-image">' + item.image + '</span>' +
                '<div class="item-details">' +
                    '<div class="item-name">' + item.name + '</div>' +
                    '<div class="item-price">KSh ' + item.price.toLocaleString() + ' / ' + item.unit + '</div>' +
                '</div>' +
                '<div class="quantity-controls">' +
                    '<button class="qty-btn" onclick="updateCartQuantity(\'' + item.id + '\', -1)">\u2212</button>' +
                    '<span class="qty-value">' + item.quantity + '</span>' +
                    '<button class="qty-btn" onclick="updateCartQuantity(\'' + item.id + '\', 1)">+</button>' +
                '</div>' +
                '<span class="item-total">KSh ' + (item.price * item.quantity).toLocaleString() + '</span>' +
                '<button class="remove-item-btn" onclick="removeFromCart(\'' + item.id + '\')" title="Remove">\u2715</button>' +
            '</div>';
        }).join('');

        var deliveryNote = getCartTotal() >= 2000 ? '<span style="color:var(--success);font-weight:600;">FREE Delivery!</span>' : '<span style="color:var(--gray-500);font-size:0.85rem;">Free delivery on orders over KSh 2,000</span>';

        container.innerHTML = '<div class="cart-items">' + itemsHtml + '</div>' +
            '<div class="cart-summary">' +
                '<div style="display:flex;justify-content:space-between;margin-bottom:0.5rem;">' +
                    '<span>' + cart.length + ' item(s)</span>' +
                    '<button style="background:none;border:none;color:var(--danger);cursor:pointer;font-family:inherit;font-size:0.85rem;" onclick="clearCart()">Clear Cart</button>' +
                '</div>' +
                '<div style="margin-bottom:0.75rem;">' + deliveryNote + '</div>' +
                '<div class="cart-total">' +
                    '<span class="label">Total</span>' +
                    '<span class="amount">KSh ' + getCartTotal().toLocaleString() + '</span>' +
                '</div>' +
                '<button class="checkout-btn" onclick="showView(\'checkout\')">Proceed to Checkout \u2192</button>' +
                '<a class="whatsapp-order-btn" href="' + generateWhatsAppOrder() + '" target="_blank" rel="noopener">\u{1F4AC} Order via WhatsApp</a>' +
            '</div>';
    }

    // ==================== CHECKOUT ====================
    function selectPayment(method) {
        selectedPayment = method;
        document.querySelectorAll('.payment-option').forEach(function(opt) {
            if (opt.dataset.method === method) {
                opt.classList.add('selected');
            } else {
                opt.classList.remove('selected');
            }
        });
    }

    function renderCheckoutSummary() {
        var summary = document.getElementById('checkout-summary');
        var deliveryFee = getCartTotal() >= 2000 ? 0 : 100;
        var total = getCartTotal() + deliveryFee;

        summary.innerHTML = '<div class="row"><span>Items (' + cart.length + ')</span><span>KSh ' + getCartTotal().toLocaleString() + '</span></div>' +
            '<div class="row"><span>Delivery</span><span style="color:' + (deliveryFee === 0 ? '#28a745' : 'inherit') + ';">' + (deliveryFee === 0 ? 'FREE' : 'KSh ' + deliveryFee) + '</span></div>' +
            '<div class="row total-row"><span>Total</span><span class="amount">KSh ' + total.toLocaleString() + '</span></div>';
    }

    function placeOrder() {
        var name = document.getElementById('checkout-name').value.trim();
        var phone = document.getElementById('checkout-phone').value.trim();
        var area = document.getElementById('checkout-area').value;
        var address = document.getElementById('checkout-address').value.trim();
        var notes = document.getElementById('checkout-notes').value.trim();

        if (!name || !phone || !address) {
            showNotification('Please fill in all required fields', 'error');
            return;
        }

        if (!/^0[17]\d{8}$/.test(phone.replace(/\s/g, ''))) {
            showNotification('Please enter a valid Kenyan phone number', 'error');
            return;
        }

        var deliveryFee = getCartTotal() >= 2000 ? 0 : 100;
        var orderId = 'MM-' + Date.now().toString(36).toUpperCase();

        var order = {
            id: orderId,
            customer: {
                name: name,
                phone: phone,
                area: area,
                address: address,
                notes: notes,
                paymentMethod: selectedPayment
            },
            items: cart.map(function(item) { return Object.assign({}, item); }),
            subtotal: getCartTotal(),
            deliveryFee: deliveryFee,
            total: getCartTotal() + deliveryFee,
            status: 'pending',
            date: new Date().toISOString()
        };

        orders.unshift(order);
        cart = [];
        updateCartBadge();
        saveData();

        document.getElementById('checkout-name').value = '';
        document.getElementById('checkout-phone').value = '';
        document.getElementById('checkout-area').value = '';
        document.getElementById('checkout-address').value = '';
        document.getElementById('checkout-notes').value = '';

        showOrderSuccessModal(orderId);
    }

    // ==================== ADMIN ====================
    function adminLogin() {
        var password = document.getElementById('admin-password').value;
        if (password === 'maisha2024') {
            isAdmin = true;
            document.getElementById('admin-password').value = '';
            showView('admin');
            showNotification('Welcome back, Admin!');
        } else {
            showNotification('Invalid password', 'error');
        }
    }

    function adminLogout() {
        isAdmin = false;
        showView('store');
        showNotification('Logged out successfully');
    }

    function renderAdminStats() {
        var container = document.getElementById('admin-stats');
        var totalProducts = Object.values(products).reduce(function(sum, dept) { return sum + dept.length; }, 0);
        var totalOrders = orders.length;
        var pendingOrders = orders.filter(function(o) { return o.status === 'pending'; }).length;
        var totalRevenue = orders.filter(function(o) { return o.status === 'completed'; }).reduce(function(sum, o) { return sum + o.total; }, 0);
        var todayOrders = orders.filter(function(o) {
            return new Date(o.date).toDateString() === new Date().toDateString();
        }).length;

        container.innerHTML = '<div class="stat-card"><div class="stat-icon">\u{1F4E6}</div><div class="stat-value">' + totalProducts + '</div><div class="stat-label">Total Products</div></div>' +
            '<div class="stat-card"><div class="stat-icon">\u{1F4CB}</div><div class="stat-value">' + totalOrders + '</div><div class="stat-label">Total Orders</div></div>' +
            '<div class="stat-card"><div class="stat-icon">\u{23F3}</div><div class="stat-value">' + pendingOrders + '</div><div class="stat-label">Pending Orders</div></div>' +
            '<div class="stat-card"><div class="stat-icon">\u{1F4B0}</div><div class="stat-value">KSh ' + totalRevenue.toLocaleString() + '</div><div class="stat-label">Total Revenue</div></div>' +
            '<div class="stat-card"><div class="stat-icon">\u{1F4C5}</div><div class="stat-value">' + todayOrders + '</div><div class="stat-label">Today\'s Orders</div></div>';
    }

    function addProduct() {
        var name = document.getElementById('new-product-name').value.trim();
        var price = parseFloat(document.getElementById('new-product-price').value);
        var unit = document.getElementById('new-product-unit').value;
        var stock = parseInt(document.getElementById('new-product-stock').value);
        var department = document.getElementById('new-product-dept').value;
        var image = document.getElementById('new-product-icon').value;

        if (!name || !price || isNaN(stock)) {
            showNotification('Please fill in all product details', 'error');
            return;
        }

        var product = {
            id: department.substring(0, 3) + '-' + Date.now(),
            name: name,
            price: price,
            unit: unit,
            stock: stock,
            image: image
        };

        if (!products[department]) {
            products[department] = [];
        }
        products[department].push(product);
        saveData();

        document.getElementById('new-product-name').value = '';
        document.getElementById('new-product-price').value = '';
        document.getElementById('new-product-stock').value = '';

        renderAdminProducts();
        renderAdminStats();
        filterProducts();
        showNotification('Product "' + name + '" added successfully!');
    }

    function editProduct(productId, department) {
        editingProductId = { id: productId, dept: department };
        renderAdminProducts();
    }

    function saveProduct(productId, department) {
        var row = document.querySelector('[data-product-id="' + productId + '"]');
        var name = row.querySelector('.edit-name').value;
        var price = parseFloat(row.querySelector('.edit-price').value);
        var stock = parseInt(row.querySelector('.edit-stock').value);

        var product = products[department].find(function(p) { return p.id === productId; });
        if (product) {
            product.name = name;
            product.price = price;
            product.stock = stock;
            saveData();
        }

        editingProductId = null;
        renderAdminProducts();
        renderAdminStats();
        filterProducts();
        showNotification('Product updated successfully!');
    }

    function cancelEdit() {
        editingProductId = null;
        renderAdminProducts();
    }

    function deleteProduct(productId, department) {
        if (!confirm('Are you sure you want to delete this product?')) return;

        products[department] = products[department].filter(function(p) { return p.id !== productId; });
        saveData();
        renderAdminProducts();
        renderAdminStats();
        filterProducts();
        showNotification('Product deleted');
    }

    function renderAdminProducts() {
        var container = document.getElementById('admin-products-list');
        container.innerHTML = '';

        Object.entries(products).forEach(function(entry) {
            var dept = entry[0];
            var items = entry[1];
            if (items.length === 0) return;

            var deptInfo = departmentInfo[dept];
            var html = '<div class="dept-section">' +
                '<span class="dept-title" style="background:' + deptInfo.color + '15;color:' + deptInfo.color + ';">' +
                deptInfo.icon + ' ' + deptInfo.name + ' (' + items.length + ' products)</span>';

            items.forEach(function(product) {
                var isEditing = editingProductId && editingProductId.id === product.id;

                if (isEditing) {
                    html += '<div class="product-row" data-product-id="' + product.id + '">' +
                        '<span class="product-icon">' + product.image + '</span>' +
                        '<input type="text" class="edit-name" value="' + product.name + '" style="flex:1;min-width:100px;">' +
                        '<input type="number" class="edit-price" value="' + product.price + '" style="width:80px;">' +
                        '<input type="number" class="edit-stock" value="' + product.stock + '" style="width:60px;">' +
                        '<div class="actions">' +
                            '<button class="save-btn" onclick="saveProduct(\'' + product.id + '\', \'' + dept + '\')">Save</button>' +
                            '<button class="cancel-btn" onclick="cancelEdit()">Cancel</button>' +
                        '</div></div>';
                } else {
                    html += '<div class="product-row" data-product-id="' + product.id + '">' +
                        '<span class="product-icon">' + product.image + '</span>' +
                        '<span class="product-name">' + product.name + '</span>' +
                        '<span class="product-price">KSh ' + product.price.toLocaleString() + '/' + product.unit + '</span>' +
                        '<span class="product-stock">Stock: ' + product.stock + '</span>' +
                        '<div class="actions">' +
                            '<button class="edit-btn" onclick="editProduct(\'' + product.id + '\', \'' + dept + '\')">Edit</button>' +
                            '<button class="delete-btn" onclick="deleteProduct(\'' + product.id + '\', \'' + dept + '\')">Delete</button>' +
                        '</div></div>';
                }
            });

            html += '</div>';
            container.innerHTML += html;
        });
    }

    // ==================== ORDERS ====================
    function updatePendingOrdersBadge() {
        var badge = document.getElementById('pending-orders-badge');
        var pendingCount = orders.filter(function(o) { return o.status === 'pending'; }).length;

        if (pendingCount > 0) {
            badge.textContent = pendingCount;
            badge.classList.remove('hidden');
        } else {
            badge.classList.add('hidden');
        }
    }

    function filterOrders(status, btn) {
        currentOrderFilter = status;
        document.querySelectorAll('#orders-filter button').forEach(function(b) { b.classList.remove('active'); });
        if (btn) btn.classList.add('active');
        renderOrders();
    }

    function updateOrderStatus(orderId, newStatus) {
        var order = orders.find(function(o) { return o.id === orderId; });
        if (order) {
            order.status = newStatus;
            saveData();
            renderOrders();
            updatePendingOrdersBadge();
            showNotification('Order ' + orderId + ' marked as ' + newStatus);
        }
    }

    function deleteOrder(orderId) {
        if (!confirm('Are you sure you want to delete this order?')) return;

        orders = orders.filter(function(o) { return o.id !== orderId; });
        saveData();
        renderOrders();
        updatePendingOrdersBadge();
        showNotification('Order deleted');
    }

    function exportOrders() {
        if (orders.length === 0) {
            showNotification('No orders to export', 'error');
            return;
        }

        var csv = 'Order ID,Date,Customer,Phone,Area,Address,Payment,Items,Subtotal,Delivery,Total,Status\n';
        orders.forEach(function(order) {
            var items = order.items.map(function(i) { return i.name + ' x' + i.quantity; }).join('; ');
            csv += '"' + order.id + '","' + new Date(order.date).toLocaleDateString() + '","' + order.customer.name + '","' + order.customer.phone + '","' + (order.customer.area || '') + '","' + order.customer.address + '","' + order.customer.paymentMethod + '","' + items + '",' + (order.subtotal || order.total) + ',' + (order.deliveryFee || 0) + ',' + order.total + ',"' + order.status + '"\n';
        });

        var blob = new Blob([csv], { type: 'text/csv' });
        var a = document.createElement('a');
        a.href = URL.createObjectURL(blob);
        a.download = 'maisha-mart-orders-' + new Date().toISOString().split('T')[0] + '.csv';
        a.click();
        showNotification('Orders exported successfully!');
    }

    function renderOrders() {
        var container = document.getElementById('orders-list');
        var filtered = currentOrderFilter === 'all' ? orders : orders.filter(function(o) { return o.status === currentOrderFilter; });

        if (filtered.length === 0) {
            container.innerHTML = '<div class="empty-state"><div class="icon">\u{1F4ED}</div><p>No ' + (currentOrderFilter === 'all' ? '' : currentOrderFilter + ' ') + 'orders yet</p></div>';
            return;
        }

        container.innerHTML = filtered.map(function(order) {
            var dateObj = new Date(order.date);
            var dateStr = dateObj.toLocaleDateString('en-KE', { dateStyle: 'medium' });
            var timeStr = dateObj.toLocaleTimeString('en-KE', { timeStyle: 'short' });

            var actions = '';
            if (order.status === 'pending') {
                actions += '<button class="process-btn" onclick="updateOrderStatus(\'' + order.id + '\', \'processing\')">Start Processing</button>';
            }
            if (order.status === 'processing') {
                actions += '<button class="complete-btn" onclick="updateOrderStatus(\'' + order.id + '\', \'completed\')">Mark Completed</button>';
            }
            if (order.status === 'pending' || order.status === 'processing') {
                actions += '<button class="cancel-btn" onclick="updateOrderStatus(\'' + order.id + '\', \'cancelled\')">Cancel</button>';
            }
            actions += '<button class="delete-btn" onclick="deleteOrder(\'' + order.id + '\')">Delete</button>';

            var itemRows = order.items.map(function(item) {
                return '<div class="order-item-row"><span>' + item.image + ' ' + item.name + ' \u00D7 ' + item.quantity + '</span><span>KSh ' + (item.price * item.quantity).toLocaleString() + '</span></div>';
            }).join('');

            return '<div class="order-card">' +
                '<div class="order-header ' + order.status + '">' +
                    '<div><span class="order-id">' + order.id + '</span><span class="order-date">' + dateStr + ' at ' + timeStr + '</span></div>' +
                    '<span class="order-status ' + order.status + '">' + order.status + '</span>' +
                '</div>' +
                '<div class="order-body">' +
                    '<div class="order-info">' +
                        '<div><span class="info-label">Customer</span><div class="info-value">' + order.customer.name + '</div></div>' +
                        '<div><span class="info-label">Phone</span><div class="info-value"><a href="tel:' + order.customer.phone + '">' + order.customer.phone + '</a></div></div>' +
                        '<div><span class="info-label">Payment</span><div class="info-value">' + (order.customer.paymentMethod === 'mpesa' ? '\u{1F4F1} M-Pesa' : '\u{1F4B5} Cash') + '</div></div>' +
                        '<div><span class="info-label">Delivery Address</span><div class="info-value">' + (order.customer.area ? order.customer.area + ' - ' : '') + order.customer.address + '</div></div>' +
                        (order.customer.notes ? '<div><span class="info-label">Notes</span><div class="info-value">' + order.customer.notes + '</div></div>' : '') +
                    '</div>' +
                    '<div class="order-items">' +
                        '<div class="title">Order Items:</div>' +
                        itemRows +
                        (order.deliveryFee !== undefined ? '<div class="order-item-row"><span>Delivery Fee</span><span>' + (order.deliveryFee === 0 ? 'FREE' : 'KSh ' + order.deliveryFee) + '</span></div>' : '') +
                        '<div class="order-total-row"><span>Total</span><span class="amount">KSh ' + order.total.toLocaleString() + '</span></div>' +
                    '</div>' +
                    '<div class="order-actions">' + actions + '</div>' +
                '</div>' +
            '</div>';
        }).join('');
    }

    // ==================== SCROLL TO TOP ====================
    window.addEventListener('scroll', function() {
        var btn = document.getElementById('scroll-top');
        if (window.scrollY > 400) {
            btn.classList.add('visible');
        } else {
            btn.classList.remove('visible');
        }
    });

    // ==================== INITIALIZE ====================
    function init() {
        loadData();
        renderDepartments();
        filterProducts();
        updateCartBadge();
    }

    init();
    </script>
</body>
</html>
